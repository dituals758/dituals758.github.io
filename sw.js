const C='weekflow-v3.0';const A=['./','./index.html','./manifest.json','./favicon.ico','./icon-72x72.png','./icon-180x180.png','./icon-192x192.png', './icon-512x512.png','./404.html','https://fonts.googleapis.com/css2?family=Inter:wght@300;350;400;450;500&display=swap'];self.addEventListener('install',e=>{e.waitUntil(caches.open(C).then(e=>e.addAll(A)).then(()=>self.skipWaiting()).catch(e=>console.error('SW install error:',e)))});self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>e!==C&&caches.delete(e)))).then(()=>self.clients.claim()).catch(e=>console.error('SW activate error:',e)))});self.addEventListener('fetch',e=>{if('GET'!==e.request.method)return;const t=e.request.url;if(t.includes('chrome-extension://')||t.includes('browser-sync'))return;const r=new URL(t),n=r.pathname.endsWith('.html')||'/'===r.pathname?'document':r.pathname.endsWith('.js')?'script':r.pathname.endsWith('.css')?'style':r.pathname.includes('manifest')?'manifest':r.pathname.includes('icon')?'icon':r.pathname.includes('font')||r.host.includes('fonts')?'font':/\.(png|jpg|jpeg|gif|svg|webp)$/i.test(r.pathname)?'image':'other';e.respondWith((async()=>{const t=await caches.open(C),a=await t.match(e.request);if(a&&['manifest','icon','font','style'].includes(n))return a;try{const a=await fetch(e.request);if(a.ok)return await t.put(e.request,a.clone()),a;throw new Error('Fetch failed')}catch(a){if(a)return a;if('document'===n){const n=await t.match('./index.html');if(n)return n}return new Response('Offline',{status:503,headers:{'Content-Type':'text/plain;charset=utf-8'}})}await fetch(e.request).then(async e=>{e.ok&&await t.put(e.request,e.clone())}).catch(()=>{})})())});self.addEventListener('message',e=>{const t=e.data;switch(t.type){case'GET_CACHE_INFO':e.ports[0]?.postMessage({type:'CACHE_INFO',version:C});break;case'CLEAR_CACHE':caches.delete(C).then(()=>{e.ports[0]?.postMessage({type:'CACHE_CLEARED'})});break}});